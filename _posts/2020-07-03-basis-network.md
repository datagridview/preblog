---
layout: single
title: 计算机网络相关
---

- [请描述三次握手？](#请描述三次握手)
  - [为什么要传回SYN？](#为什么要传回syn)
  - [为什么要带ACK？](#为什么要带ack)
  - [什么是半连接协议？](#什么是半连接协议)
  - [SYN_ACK的重传次数？](#syn_ack的重传次数)
  - [初始序列号是固定的吗？](#初始序列号是固定的吗)
  - [三次握手可以携带数据吗？](#三次握手可以携带数据吗)
  - [SYN攻击是什么？](#syn攻击是什么)
  - [有什么方法防止SYN攻击？](#有什么方法防止syn攻击)
- [请描述4次握手](#请描述4次握手)
  - [为什么要回收四次？](#为什么要回收四次)
  - [客户端为什么要等待2MSL？](#客户端为什么要等待2msl)
- [TCP、UDP的比较？](#tcpudp的比较)
- [TCP长短连接的区别？](#tcp长短连接的区别)
- [为什么TCP有拆包粘包而UDP没有？](#为什么tcp有拆包粘包而udp没有)
- [什么是拆包、粘包？](#什么是拆包粘包)
- [为什么会拆包、粘包？](#为什么会拆包粘包)
- [如何应对拆包、粘包？](#如何应对拆包粘包)
- [TCP为什么是可靠的？](#tcp为什么是可靠的)
  - [什么是RTT](#什么是rtt)
  - [流量控制怎么样的？](#流量控制怎么样的)
  - [拥塞控制是通过什么实现的？](#拥塞控制是通过什么实现的)
- [有哪些提高网络利用率的方法？](#有哪些提高网络利用率的方法)
- [浏览器访问经历的过程？](#浏览器访问经历的过程)
- [DNS的查询过程？](#dns的查询过程)
  - [DNS污染是什么？](#dns污染是什么)
- [HTTP长短链接？](#http长短链接)
- [IP地址中，那些是私有地址？](#ip地址中那些是私有地址)
- [ARP工作原理？](#arp工作原理)
- [GET/POST的区别？](#getpost的区别)
- [什么是Session？](#什么是session)
- [Session是怎么实现的？](#session是怎么实现的)
- [什么是cookie？](#什么是cookie)
- [cookie和session有什么区别？](#cookie和session有什么区别)
- [HTTPS的运行流程是怎么样的？](#https的运行流程是怎么样的)
- [状态码？](#状态码)
- [HTTP 请求类型？](#http-请求类型)
- [HTTP消息结构？手写一下？](#http消息结构手写一下)
- [CSRF是什么？](#csrf是什么)
  - [如何防范？](#如何防范)
- [HTTP1.0/1.1区别](#http1011区别)
- [VPN虚拟专用网络的原理是？](#vpn虚拟专用网络的原理是)
- [什么是NAT？](#什么是nat)
- [如何免密登录服务器？ssh](#如何免密登录服务器ssh)
- [四层和七层负载均衡的区别？](#四层和七层负载均衡的区别)
- [ping的原理？](#ping的原理)
- [ping为什么没有端口？](#ping为什么没有端口)
- [路由转发的过程是？](#路由转发的过程是)
- [路由选择协议？](#路由选择协议)

### 请描述三次握手？
为了确认双方通信正常，而执行的三次握手。

* 第一次：syn=1, seq=x，进入syn_send状态
* 第二次：syn=1, ack=1, seq=y, acknum=x+1，进入syn_rcvd状态
* 第三次：ack=1,acknum=y+1，都进入established状态

#### 为什么要传回SYN？
接受段告诉发送端我收到的信息就是发出的信号。

#### 为什么要带ACK？
证明从服务端到请求端通道完好。

#### 什么是半连接协议？
处于SYN_RCVD状态的连接，它会被放入一个队列。

#### SYN_ACK的重传次数？
未收到ACK，按指数时间间隔重传，如果超过最大数，就停止重传

#### 初始序列号是固定的吗？
不是，ISN随时间变化，每4m+1就动态生成

#### 三次握手可以携带数据吗？
只有第三次可以

#### SYN攻击是什么？
伪造客户端不断发包，占用半连接队列使请求被丢弃。

#### 有什么方法防止SYN攻击？
* SYN TIMEOUT off
* 增加半连接队列长度
* 过滤网关保护
* SYN cookie

### 请描述4次握手
* 第一次：fin=1，seq=x FIN_WAIT1-->CLOSEDWAIT
* 第二次：ack=1, acknum=x+1 FINWAIT2<--
* 第三次：fin=1, seq=y TIME_WAIT<--LAST_ACK
* 第四次：ack=1, acknum=y+1 -->CLOSED
* 后续：2MSL CLOSED

一旦收到一个FIN，表示这个通道上就没有数据流动了。

服务器端没有TIME_WAIT，通常只能被动关闭。

#### 为什么要回收四次？
因为服务器端可能还有数据没传完，传完才能发FIN。


#### 客户端为什么要等待2MSL？
* 为保证最后一个ACK到达服务器，不然服务器无法被动关闭
* 防止失效的请求报文出现在连接中

### TCP、UDP的比较？

| 协议  | 连接   | 是否可靠 | 原理  | 效率 | 占用  | 场景 | 首部      |
|-----|------|------|-----|----|-----|----|---------|
| TCP | 面向连接 | 可靠   | 字节流 | 慢  | 资源多 | 可靠 | 20-60字节 |
| UDP | 无连接  | 不可靠  | 报文段 | 快  | 资源少 | 快速 | 8字节     |

Socket是TCP/IP的抽象层

TCP有确认、窗口、重传、拥塞控制

* ECE：IP中ECN为1时置为1，表示有阻塞
* URG：紧急指针
* PSH：立即上传至上层协议
* RST：TCP异常，强制断开

### TCP长短连接的区别？
* 短：一次读写，一次close
* 长：请求端不主动关闭连接，会给server造成压力。有存货功能探测

### 为什么TCP有拆包粘包而UDP没有？
UDP 16bit报文指示长度，很容易区分

TCP 没有表示数据长度的字符

### 什么是拆包、粘包？
粘包：发两个数据包，收到时合成为一个

拆包：发两个数据包，收到时拆了一个

### 为什么会拆包、粘包？
* 发送的数据大于TCP发送缓冲区的剩余大小
* 带发送数据大于MSS最大报文长度
* 发送数据小于发送缓冲区大小，TCP多次写入数据一次发出，粘包
* 接受端没有及时读取接收缓冲区数据、粘包

### 如何应对拆包、粘包？
* 消息定长
* 设置消息边界，增加换行符分割
* 消息头和消息体中包含总长度

### TCP为什么是可靠的？
#### 什么是RTT
从发送到收到确认所经历的时间（往返时间）
$$RTO=RTT_s+4*RTT_d$$

#### 流量控制怎么样的？

控制发送速率，保证**接收方来得及接收**。发送端主机是不是发送一个窗口探测的数据段，仅包含一个字节来获得最新的窗口大小。

#### 拥塞控制是通过什么实现的？

能够降低**整个网络**的拥堵程度。

通过四个算法：慢开始、快重传、拥塞避免、快恢复

* 慢开始：$cwnd=1$，收到确认，2，4，8增长
* 拥塞避免：当$cwnd>=ssthresh$，$cwnd+=1$；如果超时或重复确认，ssthresh就变成cwnd/2，如果因为超时，就直接慢开始
* 快重传：3个重复确认，直接重传
* 快恢复：三个重复确认，$ssthresh=cwnd/2$，但不是慢开始，$cwnd=ssthresh$，然后加法增大。

### 有哪些提高网络利用率的方法？
* Nagle
* 延迟确认应答
* 捎带应答


### 浏览器访问经历的过程？
1. 域名DNS IP
2. 发送HTTP请求
3. TCP过程
4. 反向代理
5. 服务器
6. 缓存集群
7. 数据库
8. HTTP响应
9. 渲染HTML

### DNS的查询过程？
是一种递归查询。现在本地域名服务器中找，根到子域查询。

浏览器缓存、系统缓存、路由器缓存、IPS服务器缓存、根域名缓存、顶级域名服务器、主域名服务器缓存。

#### DNS污染是什么？




### HTTP长短链接？
* HTTP/1.0 短链接，每次都是一个会话
* HTTP/1.1 默认长连接，需要C/S都支持长连接

其实是TCP的长连接和短链接

### IP地址中，那些是私有地址？

* 10.0.0.0 - 10.255.255.255
* 172.16.0.0 - 172.31.255.255
* 192.168.0.0 - 192.168.255.255

### ARP工作原理？

建立了一个ARP表，定义了IP和MAC地址映射关系。

1. 先查看ARP表
2. 如果没有，则广播自己的IP和MAC地址，寻求指定IP的MAC地址
3. 其他主机收到这则广播之后先记录其IP和MAC地址的映射，如果IP是自己的，就回应
4. 请求方收到后（单播形式），写入IP和MAC

### GET/POST的区别？

| 方法  | 是否幂等  | 安全性  | 参数  | 是否可缓存  |
|------|-----|------|-------|------|
| GET  | 幂等  | 不安全  | 参数可见  | 可缓存  |
| POST | 非幂等 | 相对安全 | 参数不可见 | 不可缓存 |

### 什么是Session？
Session是**客户凭证**。因为HTTP是一个**无状态**的协议，因此使用Session来**保存用户的上下文**，**保存在服务器端**。当第一次访问服务器的时候会生成一个session。创建Session的时候，服务器将生成一个唯一的sessionid然后用它生成一个关闭浏览器就会失效的cookie，然后在后面的访问中更新这个session的时间信息。

### Session是怎么实现的？

* Java中使用cookie保存JSession ID，值为Session ID
* 重写URL，把SessionID编织在URL中
* 表单域隐藏

### 什么是cookie？
* 用于会话管理
* 个性化管理
* 浏览器行为跟踪

### cookie和session有什么区别？

* 作用范围：cookie客户端，session服务器端
* 存取方式：cookie ASCII，session任意类型
* 有效时间：cookie长期保持，session相对较短
* 隐私策略：cookie会被窃取
* 大小：一般cookie<4k，session远高于4k

sessionID是cookie和session之间的桥梁

Token相比较于Session的优点在于，当后端系统有多台时，由于是客户端访问时直接带着数据，因此无需做共享数据的操作。

### HTTPS的运行流程是怎么样的？
1. 发送HTTPS请求连接到443端口，包含TLS版本、可用算法
2. server返回数字证书何所选的版本
3. 验证证书的合法性，包含公钥
4. 客户端生成一个伪随机数，用公钥加密
5. 服务器端用私钥解密，双方基于随机数生成对称主密钥
6. 进行finish校验
7. 双方使用对称密钥进行加密通信

### 状态码？
`200` 客户端请求成功
`201` 请求已成功，新的资源被创建
`203` 转换代理服务器
`301` 永久重定向
`302` 临时重定向
`400` 客户端格式错误
`401` unauthorized
`403` forbidden
`404` not found
`500` 服务器未曾预料的错误
`502` 网关上游问题
`503` 服务器目前不能处理请求


### HTTP 请求类型？
* OPTIONS：返回服务器针对特定资源所支持的HTTP请求方法。也可以利用向Web服务器发送'*'的请求来测试服务器的功能性。
* HEAD：向服务器索要与GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以在不必传输整个响应内容的情况下，就可以获取包含在响应消息头中的元信息。
* GET：向特定的资源发出请求。
* POST：向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的创建和/或已有资源的修改。
* PUT：向指定资源位置上传其最新内容。
* DELETE：请求服务器删除 Request-URI 所标识的资源。
* TRACE：回显服务器收到的请求，主要用于测试或诊断。
* CONNECT：HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。


### HTTP消息结构？手写一下？

![uXLSkfpAl7sPROW](https://i.loli.net/2020/07/08/uXLSkfpAl7sPROW.png)

### CSRF是什么？
跨站请求伪造，伪造、冒充用户进行操作。

#### 如何防范？
* 关键操作只接收post操作
* 检测referer
* 验证码
* token

### HTTP1.0/1.1区别

1.1默认长连接
1.1增加Host，支持虚拟站点
1.1还提供了与身份认证、状态管理和Cache缓存等机制相关的请求头和响应头


### VPN虚拟专用网络的原理是？
VPN 使用公用的互联网作为本机构各专用网之间的通信载体。专用指机构内的主机只与本机构内的其它主机通信；虚拟指好像是，而实际上并不是，它有经过公用的互联网。

下图中，场所 A 和 B 的通信经过互联网，如果场所 A 的主机 X 要和另一个场所 B 的主机 Y 通信，IP 数据报的源地址是 10.1.0.1，目的地址是 10.2.0.3。数据报先发送到与互联网相连的路由器 R1，R1 对内部数据进行加密，然后重新加上数据报的首部，源地址是路由器 R1 的全球地址 125.1.2.3，目的地址是路由器 R2 的全球地址 194.4.5.6。路由器 R2 收到数据报后将数据部分进行解密，恢复原来的数据报，此时目的地址为 10.2.0.3，就交付给 Y。

[原文链接](https://yuerblog.cc/2017/01/03/how-vpn-works-and-how-to-setup-pptp/)

### 什么是NAT？
专用网内部的主机使用本地 IP 地址又想和互联网上的主机通信时，可以使用 NAT 来将本地 IP 转换为全球 IP。

在以前，NAT 将本地 IP 和全球 IP 一一对应，这种方式下拥有 n 个全球 IP 地址的专用网内最多只可以同时有 n 台主机接入互联网。为了更有效地利用全球 IP 地址，现在常用的 NAT 转换表把传输层的端口号也用上了，使得多个专用网内部的主机共用一个全球 IP 地址。使用端口号的 NAT 也叫做网络地址与端口转换 NAPT。


### 如何免密登录服务器？ssh

![nBo2tLzVkucbJE6](https://i.loli.net/2020/07/08/nBo2tLzVkucbJE6.png)

### 四层和七层负载均衡的区别？
四层工作在OSI第四层，也就是传输层；七层工作在最高层，也就是应用层。

* 四层IP加端口路由转发；七层基于请求URL地址转发
* 四层使用TCP三次握手连接是与后端服务器直接建立起来的；七层先与服务建立联系，服务再与后端建立联系。
* 四层: F5、LVS等；七层: nginx、apache等

### ping的原理？
Ping程序的实质是利用了ICMP请求回显和回显应答报文。

### ping为什么没有端口？
ICMP在网络层，没有端口的概念。

### 路由转发的过程是？
1. 从数据报的首部提取目的主机的 IP 地址 D，得到目的网络地址 N。
2. 若 N 就是与此路由器直接相连的某个网络地址，则进行直接交付；
3. 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给表中所指明的下一跳路由器；
4. 若路由表中有到达网络 N 的路由，则把数据报传送给路由表中所指明的下一跳路由器；
5. 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；
6. 报告转发分组出错。

### 路由选择协议？
[原文链接](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20-%20%E7%BD%91%E7%BB%9C%E5%B1%82.md#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE)